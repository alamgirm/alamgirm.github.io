<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Designing a simple Assembler</title>
    <meta name="description" content="Alamgir's Blog - Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/blog/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/blog/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/blog/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/blog/page2/" />

    <meta property="og:site_name" content="Alamgir's Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Alamgir's Blog" />
    <meta property="og:description" content="Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT." />
    <meta property="og:url" content="/blog/" />
    <meta property="og:image" content="/blog/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Alamgir's Blog" />
    <meta name="twitter:description" content="Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT." />
    <meta name="twitter:url" content="/blog/" />
    <meta name="twitter:image:src" content="/blog/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "blog",
    "publisher": "Alamgir Mohammed",
    "url": "/blog/",
    "image": "/blog/assets/images/cover1.jpg",
    "description": "Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Alamgir's Blog" href="/blog/feed.xml" />


</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/blog/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/blog/about">About</a></li>
        <li class="nav-emb " role="presentation"><a href="/blog/tag/Data Science">Data Science</a></li>
        <li class="nav-emb " role="presentation"><a href="/blog/tag/Machine Learning">Machine Learning</a></li>
        <li class="nav-emb " role="presentation"><a href="/blog/tag/Programming">Programming</a></li>
        <li class="nav-emb " role="presentation"><a href="/blog/tag/Visualization">Visualization</a></li>
        <li class="nav-ard " role="presentation"><a href="/blog/tag/Arduino">Arduino</a></li>
        <li class="nav-rasp " role="presentation"><a href="/blog/tag/Raspberry Pi">Raspberry Pi</a></li>
        <li class="nav-iot " role="presentation"><a href="/blog/tag/IoT">IoT</a></li>
	<li class="nav-author " role="presentation"><a href="/blog/author/alamgir">Author</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/blog/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/blog/assets/images/cover/cover7.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/blog/"><img src="/blog/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Designing a simple Assembler</h1>
            <section class="post-meta">
            <!-- <a href='/blog/'>alamgir</a> -->
            <time class="post-date" datetime="2017-06-04">04 Jun 2017</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/blog/tag/MCU'>Mcu</a>,
                       
                
                    
                       <a href='/blog/tag/assembler'>Assembler</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            
            <p>Following on the design of a simple microprocessor in the <a href="design-a-simple-microprocessor.html ">last post</a>, this post talks about writing a simple assembler for that processor. The main aim of attempting to write an assembler is to learn how the assembly to machine code conversion works.</p>

<!--more-->

<p>When writing the assembler, in addition to the instructions offered by the MPU, we can add extra instructions that would map down to the MPU insturctions during assebmling process. For simplicity of programming, I added two instrucions: CMP (meaning complement, functionally same as NOT), and COMP (compare, functionally same as SUB).</p>

<p>We now have a total of 16+2=18 keywords to handle. The Keywords are: <br /></p>

<pre>NOP, STOP, DUMP, LOAD, STOR, XCHG, JMP, JMPE, ADD, 
SUB, INC, DEC, AND, OR, NOT, XOR, CMP, COMP</pre>

<p>And if you look at the opcodes for these instructions <a href="design-a-simple-microprocessor.html#opcode_mnemonic">mnemonics</a>, the corresponding machine codes should be (in hexadecimal): <br /></p>

<pre>
0, 1, 2, 3, 4, 5, 6, 7, 8, 
9, A, B, C, D, E, F, E, 9
</pre>

<h2 id="assembly-process">Assembly process</h2>
<p>The assembling process is essentially reading the assembly language program, and going line by line to find the equivalent machine code. To find the meaning of a line of assembly code, we need to build a parser that could parse all the assembly instructions we would like the assembler to recognize.</p>

<p>A finite automata (also called state machine) is a perfect tool for modeling the parsing process. Given the 18 keywords that we need to detect, the following is an automata that could do that:</p>

<p><img src="/assets/images/2017/17_06_04_keyword_automata.png" alt="Finite Automata" title="Finite automata for parsing keywords." /></p>

<p>How it works is quite easy to understand. Say we have one line of text from a program written in assesbly language. We begin at the round rectangle block <code class="highlighter-rouge">Begin</code> and read the first character of the input text line. We check if it is either A, C, D, I, J, L, N, O, S or X. If the answer is positive, we move to next character, otherwise, the current characte is possibly a white space or a wrong insttuction. If for example, the first character was A, the second character from the input now has to be either D or N. Otherwise we have an invalid input. We keep on doing this until we end up at a hexagone or detect an error.</p>

<p>All the cicles are intermediary states meaning we have not finished parsing yet. When and if we reach the hexagon, we have successfully identifed or better say parsed an instruction. Consider <code class="highlighter-rouge">Begin</code> as the root of a tree and the hexagons as the leaves. Then following any branch and collecting the label letters will give us only the valid instructions. For instance, from top we have: <br /></p>
<pre>
 ADD
 AND
 CMP
 COMP
 DEC
 DUMP
 INC  etc</pre>

<h2 id="additions-to-the-mpu">Additions to the MPU</h2>
<p>Since the first design of the MPU, there have been few slight modifications, in fact additions, to have better programming capability.  The addtions are: having a register I (Index register) that points to the address in data memory where a data would be written to or read from. Another addition is ADD/SUB/AND/OR/XOR/CMP/NOT can now take register argument. Say, <code class="highlighter-rouge">ADD B</code> is now a valid instruction that adds the value of B to  A and stores the result in R. Another addition is made to XCHG that can now take an argument, and based on it, can move values between registers in more flexible ways. For instance, <code class="highlighter-rouge">XCHG $1</code> will cause the value of A to go to I.</p>

<h3 id="example-program">Example Program</h3>
<p>Here is an example program that the assembler can read and convert into machine code:</p>
<pre>
1  LOAD $0   //load 0 to A
2  XCHG $1   // move 255 to I register
3  LOAD $FF
4  XCHG $0   // move 255 to B
5  LOAD $0   // load 0 into A
6  JMPE $    // if A = B = 255 break loop
7  STOR $55  // store $55 to memory location pointed by I register
8  INC  AX    // RX &lt;= A+1
9  XCHG $2   // move back to AX
10 INC  IX    // R = I+1 
11 XCHG $3  // i = i+1
12 JMP  $6
13 DUMP $2
14 STOP
</pre>
<p><em>Note</em>: Anything after // is comment and is meant for programmer, it is ignored by the assembler. The line numbers at the beginning of each line, is also for ease of reading.</p>

<p>Once the assembler is run on this program, it produces the following output:</p>
<pre>
3200
5201
32FF
5200
3200
7207
4255
A300
5202
A303
5203
6206
2202
1000
</pre>

<p>These machine codes are ready to be loaded to the MPU for execution.</p>

<h4 id="source-code">Source Code</h4>
<p>The source code for the simple assembler can be found in <a href="https://github.com/alamgirm/assembler">Github repo</a>.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/blog/author/alamgir" style="background-image: url(/blog/assets/images/alamgir.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/blog/author/alamgir">alamgir</a></h4>
                
                
                    <p> A human being with passion for science, technology, music and history.</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Ontario, Canada</span> 
                    <span class="author-link icon-link"><a href="https://alamgirm.github.io/blog/"> https://alamgirm.github.io/blog</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Designing a simple Assembler&amp;url=https://alamgirm.github.iodesign-a-simple-assembler"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://alamgirm.github.iodesign-a-simple-assembler"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://alamgirm.github.iodesign-a-simple-assembler"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            <!-- if page.disqus  -->
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'true'; // required: replace example with your forum shortname
        var disqus_identifier = '/design-a-simple-assembler';
        var disqus_url = 'https://alamgirm.github.io/design-a-simple-assembler';
 
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            <!--  endif  -->
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/blog/assets/images/cover/cover7.jpg)" href="/blog/microprocessor-micro-controller-and-programming">
            <section class="post">
                <h2>Microprocessor, microcontroller and programming</h2>
                <p>A microprocessor, or microprossor unit (MPU) often also known as central processing unit (CPU) is...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/blog/assets/images/cover/cover6.jpg)" href="/blog/design-a-simple-microprocessor">
            <section class="post">
                <h2>Designing a simple microprocessor</h2>
                <p>A microprocessor is physicaly a semiconductor chip with lots of pins to connect to other...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/blog/">Alamgir's Blog</a> &copy; 2017</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/blog/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/blog/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-450244-4', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
