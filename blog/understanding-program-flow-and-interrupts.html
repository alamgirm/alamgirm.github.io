<!DOCTYPE html>
<html>
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>Understanding Program Flow and Interrupts</title>
    <meta name="description" content="Alamgir's Blog - Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT." />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    <meta property="og:site_name" content="Alamgir's Blog" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Alamgir's Blog" />
    <meta property="og:description" content="Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT." />
    <meta property="og:url" content="/" />
    <meta property="og:image" content="/assets/images/cover1.jpg" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Alamgir's Blog" />
    <meta name="twitter:description" content="Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT." />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover1.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "blog",
    "publisher": "Alamgir Mohammed",
    "url": "/",
    "image": "/assets/images/cover1.jpg",
    "description": "Programming, Automation, Data Science, Machine Learning, Visualizations, Arduino, Raspberry Pi and other IoT."
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Alamgir's Blog" href="/feed.xml" />


</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-emb " role="presentation"><a href="/tag/Data Science">Data Science</a></li>
        <li class="nav-emb " role="presentation"><a href="/tag/Machine Learning">Machine Learning</a></li>
        <li class="nav-emb " role="presentation"><a href="/tag/Programming">Programming</a></li>
        <li class="nav-emb " role="presentation"><a href="/tag/Visualization">Visualization</a></li>
        <li class="nav-ard " role="presentation"><a href="/tag/Arduino">Arduino</a></li>
        <li class="nav-rasp " role="presentation"><a href="/tag/Raspberry Pi">Raspberry Pi</a></li>
        <li class="nav-iot " role="presentation"><a href="/tag/IoT">IoT</a></li>
	<li class="nav-author " role="presentation"><a href="/author/alamgir">Author</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head " style="background-image: url(/assets/images/cover/cover7.jpg) ">
    <nav class="main-nav  overlay  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-test tag-content">

        <header class="post-header">
            <h1 class="post-title">Understanding Program Flow and Interrupts</h1>
            <section class="post-meta">
            <!-- <a href='/'>alamgir</a> -->
            <time class="post-date" datetime="2017-06-05">05 Jun 2017</time>
                <!-- [[tags prefix=" on "]] -->
                 
                on 
                
                    
                       <a href='/tag/MCU'>Mcu</a>,
                       
                
                    
                       <a href='/tag/Interrupt'>Interrupt</a>
                       
                
                
            </section>
        </header>

        <section class="post-content">
            
            <p>Once we understand how a microprocessor works, and how programs are written and get executed by a microprocessor, it is time to dig deeper and learn in detail on how the control in a program flows between instruction to instruction. This posts talks about the flow or path of execution in a program, and how and when the microprocessor could break that flow. In particular, we’ll learn about interrupts- a very useful mechanism to allow priority and importance in program execution.</p>

<!--more-->

<h2 id="control-flow">Control Flow</h2>
<p>Lets begin with an example program in assembly language:</p>
<pre>
0  LOAD $8    // load 8 to A, initialize A
1  XCHG $0    // BX &lt;= AX, move the value of A to B
2  LOAD $10   // load 10 to A, initialize A
3  DEC  AX    // R &lt;= AX -1, decrement A
4  XCHG $3    // AX &lt;= R, move the result back to A
5  JMPE $7    // if A = B jump to instruction at $7
6  JMP  $3    // jump back to $3, continue loop
7  DUMP $2    // dump values
8  STOP       // stop the processor
</pre>

<p>The number on the left denotes the physical memory address of each program statement. The program begins with loading $8 to register B (by first loading it into A, then exchanging), then loads $10 to register A.  The next two statements decrease the value of A by 1. After that, we compare the values of registers A and B and if equal, break the loop by jumping out of it to address $7. If the values are not equal, the statement <code class="highlighter-rouge">JMP $3</code> takes us back to the decremnt statement at address $3.</p>

<p>If we have a highlighter to point to the current line (the one being executed by the MPU), then these will be the sequecnce of instructions as executed by the processor:</p>
<pre>
	0
	1		// A now has 8
	2		// B now has 8 (A also has 8)
	3		// A now has 10, B has 8
	4		// A has 10, R has 9, B has 8
	5		// A has 9, B has 8
	6		// A has 9, B has 8
	3		// A has 9, B has 8
	4		// A has 9, R has 8, B has 8
	5		// A has 8, B has 8
	7		// A has 8, B has 8
	8		// microprocessor halts
</pre>
<p>If we notice carefully, the statements at addresses <code class="highlighter-rouge">3,4,5</code> get executed twice. After first round, the processor executes <code class="highlighter-rouge">6</code> then goes back to <code class="highlighter-rouge">3</code>, and on the second round the microprocessor skips the statement at <code class="highlighter-rouge">6</code> and jumps to <code class="highlighter-rouge">7</code>. The flow of control (the statement that is being executed) here is definetely not linear. Well, it is linear unless not broken by a JMP/JMPE instruction.</p>

<h2 id="sub-routine-or-function">Sub-routine or Function</h2>
<p>Repeating a group of statements is called looping in high-level languages. Another feature almost all high-level languages offer is called sub-routine or function. The idea behind sub-routine/function is to write a small program to perform a certain specific task and then reuse it as many times as possible, without rewriting it. So, for example, we could wirte a few statements to find the bigger number from a pair of given numbers. We could expect that the numbers to be compared be given in register A and B, and the result will be provided in register R. Now lets assume these group of statements (called subroutine/function now) be placed at memory address $12.</p>

<p>Now when writng our main program, and when in need of finding the bigger of two numbers, we would just load the numbers in A and B, and then <em>call</em> the subroutine we just created before. In fact, we’d have to make a JUMP to address $12. And once that is done, we will have to come back right where we left off before making the jump.</p>

<p>Here is a demo example.</p>
<pre>
	 0  LOAD $8    // load 8 to A, initialize
	 1  XCHG $0    // BX &lt;= AX, move the value of A to B
	 2  LOAD $10   // load 10 to A, initialize A
	 3  JMP  $2F   // call the subroutine
	 4  XCHG $3    // call retruns here, move the result R to A
	 5  DUMP $2    // dump values to show result
	 6  JUMP $1F   // jump to the end of program
	...................................................
	
	12 SUB BX      // R &lt;= AX - BX
	13 ------	   // if R has Sign Flag on
	14 ------	   // B is bigger
	15 ------	   // otherwise, A is bigger
	16 JMP $4      // return to caller routine
	...................................................
	 			
	1F  STOP       // stop the processor
</pre>
<p>What goes inside the subroutine is ommitted here for simplicity, and it was assumed the subroutine knows the program address $4 (where to return to). And, it was assumed the MPU does not have any special instructions specifically designed to support function call. In practice, real MPUs do have instructions to make function call easier.</p>

<p>Use of subroutine/function is no different to the MPU, it executes the statements in the same manner, as it does the main program. The only benefit is to the programmer, who can better organize the program when writing.</p>

<h2 id="interrupts">Interrupts</h2>
<p>The simple microprocessor we <a href="/design-a-simple-microprocessor.html ">designed</a> does not support any kind of priority or urgency. For instance, if the microprocessor is busy running a long loop, there is no means for the programmer to stop or cancel the loop without resetting or powering off the MPU. We ccould add a register named NR (iNterrup Register) in the design, and a hardware pin named IntReq (Interrupt Request). The idea is to put an address (of the starting statemnt of a group of instruction or subroutine)  in NR, and make the MPU jump that address whenever the pin IntReq becomes active. Once that subroutne is done, the MPU will come back where it left off before the IntReq pin became active. Making the IntReq pin active is known as interrupt request, and the subroutine that executes in response to this request is called <em>interrup service routine</em> (ISR).</p>

<p>Interrupts are very common in commercial MPU, and in fact most MPU support more than one interrupt. It is also common to extend the interrupt request feature so that more than one request could be handled. For instance, our MPU could set aside 8-bit x 16 memory, where 16 different memory addresses would be stored. Before making an interrupt request, a device first put its identifier (say betweet 0 and F) into a pre-designated register or memory address, and then make IntReq active. The interrupt service will first see the id of requesting device and then based on it, choose the corresponding entry of the 8-bit x 16 memory table. No wonder, such table is known as <em>interrupt vector table</em> since each entry of the table is an address (vector) of the subroutine corresponding to an interrup request.</p>

<p>While interrupts are great, it makes the control flow of program unpredictable. It is not possible beforehand which interrup will go active and when. Some MPUs, also prioritize interrupts meaning some interrupts are more important than others.</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/alamgir" style="background-image: url(/assets/images/alamgir.jpg)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/alamgir">alamgir</a></h4>
                
                
                    <p> A human being with passion for science, technology, music and history.</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Ontario, Canada</span> 
                    <span class="author-link icon-link"><a href="https://alamgirm.github.io"> https://alamgirm.github.io/blog/</a></span> 
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=Understanding Program Flow and Interrupts&amp;url=https://alamgirm.github.iounderstanding-program-flow-and-interrupts"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=https://alamgirm.github.iounderstanding-program-flow-and-interrupts"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=https://alamgirm.github.iounderstanding-program-flow-and-interrupts"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
            
            <!-- Add Disqus Comments -->
            <!-- if page.disqus  -->
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'true'; // required: replace example with your forum shortname
        var disqus_identifier = '/understanding-program-flow-and-interrupts';
        var disqus_url = 'https://alamgirm.github.io/understanding-program-flow-and-interrupts';
 
            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            <!--  endif  -->
            
        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story " style="background-image: url(/assets/images/cover/cover7.jpg)" href="/earlier-microprocessor-intel-8080">
            <section class="post">
                <h2>Earliest Microprocessor: Intel 8080</h2>
                <p>The history of what we know as microprocessor (MPU) began with Intel Corporation's 4004 chip,...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/cover/cover7.jpg)" href="/microprocessor-micro-controller-and-programming">
            <section class="post">
                <h2>Microprocessor, microcontroller and programming</h2>
                <p>A microprocessor, or microprossor unit (MPU) often also known as central processing unit (CPU) is...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Alamgir's Blog</a> &copy; 2017</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-450244-4', 'auto');
	    ga('send', 'pageview');

     </script>   
</body>
</html>
